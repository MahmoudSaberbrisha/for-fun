<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>تكوين مجلس الإدارة</title>
    <link rel="stylesheet" href="/frontend/styles/style.css" />
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%);
        margin: 0;
        padding: 0;
        min-height: 100vh;
      }
      .container {
        display: flex;
        flex-direction: row;
        min-height: 100vh;
        width: 100vw;
        box-sizing: border-box;
      }
      .scroll-container {
        width: 100%;
        max-width: 100vw;
        min-height: 100vh;
        overflow: auto;
        border: none;
        padding: 40px 32px 32px 32px;
        box-sizing: border-box;
        background: rgba(255, 255, 255, 0.95);
        margin: 0;
        border-radius: 0;
        box-shadow: 0 8px 32px 0 rgba(76, 175, 80, 0.1);
        transition: box-shadow 0.3s;
      }
      h1,
      h2 {
        text-align: center;
        margin-bottom: 30px;
        color: #219150;
        letter-spacing: 1px;
        text-shadow: 0 2px 8px #e8f5e9;
      }
      form {
        margin-bottom: 30px;
        background: linear-gradient(120deg, #e8f5e9 60%, #ffffff 100%);
        padding: 24px 18px;
        border-radius: 16px;
        box-shadow: 0 2px 16px rgba(76, 175, 80, 0.07);
        border: 1px solid #c8e6c9;
        animation: fadeIn 1s;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .form-row {
        display: flex;
        gap: 24px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
      .form-group {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 180px;
        margin-bottom: 8px;
      }
      .form-group label {
        margin-bottom: 4px;
        font-weight: 600;
        color: #219150;
        letter-spacing: 0.5px;
      }
      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 9px 10px;
        border: 1.5px solid #b2dfdb;
        border-radius: 6px;
        font-size: 1em;
        background: #f9fff9;
        transition: border 0.2s, box-shadow 0.2s;
        box-shadow: 0 1px 4px rgba(76, 175, 80, 0.04);
      }
      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        border-color: #43a047;
        outline: none;
        box-shadow: 0 0 0 2px #a5d6a7;
      }
      button {
        margin-top: 15px;
        padding: 12px 36px;
        background: linear-gradient(90deg, #43a047 60%, #81c784 100%);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1.1em;
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(76, 175, 80, 0.1);
        transition: background 0.2s, transform 0.2s;
      }
      button:hover {
        background: linear-gradient(90deg, #388e3c 60%, #66bb6a 100%);
        transform: translateY(-2px) scale(1.03);
      }
      table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin-top: 20px;
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 12px rgba(76, 175, 80, 0.07);
        animation: fadeIn 1.2s;
      }
      table,
      th,
      td {
        border: none;
      }
      th,
      td {
        padding: 13px 10px;
        text-align: center;
      }
      th {
        background: linear-gradient(90deg, #e8f5e9 80%, #c8e6c9 100%);
        color: #219150;
        font-weight: 700;
        font-size: 1.05em;
        border-bottom: 2px solid #a5d6a7;
      }
      tr:nth-child(even) {
        background: #f1f8e9;
      }
      tr:hover {
        background: #e0f2f1;
        transition: background 0.2s;
      }
      a {
        color: #219150;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s;
      }
      a:hover {
        color: #388e3c;
        text-decoration: underline;
      }
      .img-preview {
        max-width: 100px;
        max-height: 100px;
        border-radius: 6px;
        border: 1.5px solid #b2dfdb;
        box-shadow: 0 1px 4px rgba(76, 175, 80, 0.08);
      }
      .members-checkboxes {
        max-height: 200px;
        overflow-y: auto;
        border: 1.5px solid #b2dfdb;
        padding: 10px;
        border-radius: 6px;
        background: #f9fff9;
        box-shadow: 0 1px 4px rgba(76, 175, 80, 0.04);
      }
      .members-checkboxes input[type="checkbox"] {
        accent-color: #43a047;
        transform: scale(1.15);
        margin-left: 6px;
      }
      .members-checkboxes label {
        color: #388e3c;
        font-size: 1em;
        margin-right: 4px;
      }
      @media (max-width: 900px) {
        .form-row {
          flex-direction: column;
          gap: 0;
        }
        .container {
          flex-direction: column;
        }
        .scroll-container {
          margin: 0;
          padding: 18px 4vw;
        }
        table,
        th,
        td {
          font-size: 0.98em;
        }
      }
      @media (max-width: 600px) {
        .scroll-container {
          padding: 8px 2vw;
        }
        form,
        table {
          padding: 0;
        }
        th,
        td {
          padding: 7px 2px;
        }
      }
    </style>
  </head>
  <body>
    <%- include('partials/navbar') %>

    <div class="container" style="margin-top: 20px">
      <%- include('partials/sidebar') %>
      <div class="scroll-container">
        <h1>تكوين مجلس الإدارة</h1>
        <form action="/api/boards" method="POST" enctype="multipart/form-data">
          <div class="form-row">
            <div class="form-group">
              <label for="boardCode">كود المجلس</label>
              <input
                type="text"
                id="boardCode"
                name="boardCode"
                value="<%= newBoardCode %>"
                readonly
                required
              />
            </div>
            <div class="form-group">
              <label for="startDateHijri">التاريخ هجري</label>
              <input
                type="text"
                id="startDateHijri"
                name="startDateHijri"
                required
              />
            </div>
            <div class="form-group">
              <label for="startDateGregorian">التاريخ ميالدي</label>
              <input
                type="date"
                id="startDateGregorian"
                name="startDateGregorian"
                required
              />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="appointmentDecisionNumber">رقم قرار التعيين</label>
              <input
                type="text"
                id="appointmentDecisionNumber"
                name="appointmentDecisionNumber"
                required
              />
            </div>
            <div class="form-group">
              <label for="endDateHijri">التاريخ الانتهاء هجري</label>
              <input
                type="text"
                id="endDateHijri"
                name="endDateHijri"
                required
              />
            </div>
            <div class="form-group">
              <label for="endDateGregorian">التاريخ الانتهاء ميالدي</label>
              <input
                type="date"
                id="endDateGregorian"
                name="endDateGregorian"
                required
              />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="decisionImage">صورة قرار المجلس</label>
              <input
                type="file"
                id="decisionImage"
                name="decisionImage"
                accept="image/*"
                required
              />
            </div>
            <div class="form-group">
              <label for="boardStatus">حالة المجلس</label>
              <select id="boardStatus" name="boardStatus" required>
                <option value="">اختر الحالة</option>
                <option value="نشط">نشط</option>
                <option value="منتهي">منتهي</option>
                <option value="معلق">معلق</option>
              </select>
            </div>
            <div class="form-group">
              <label for="reason">السبب</label>
              <textarea id="reason" name="reason" rows="3"></textarea>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>أعضاء المجلس</label>
              <div class="members-checkboxes">
                <% if (members && members.length > 0) { %> <%
                members.forEach(function(member) { %>
                <div>
                  <input
                    type="checkbox"
                    id="member_<%= member._id %>"
                    name="members"
                    value="<%= member._id %>"
                  />
                  <label for="member_<%= member._id %>">
                    <%= member.name %> (رقم العضوية: <%= member.membershipNumber
                    %>)
                  </label>
                </div>
                <% }); %> <% } else { %>
                <p>لا توجد أعضاء لعرضها</p>
                <% } %>
              </div>
            </div>
          </div>
          <button type="submit">حفظ</button>
        </form>

        <h2>قائمة المجالس الحالية</h2>
        <table>
          <thead>
            <tr>
              <th>كود المجلس</th>
              <th>رقم التعيين</th>
              <th>التاريخ</th>
              <th>الحالة</th>
              <th>عدد الأعضاء</th>
              <th>التفاصيل</th>
              <th>تعديل</th>
              <th>عرض صورة القرار</th>
            </tr>
          </thead>
          <tbody>
            <% if (boards && boards.length > 0) { %> <%
            boards.forEach(function(board) { %>
            <tr>
              <td><%= board.boardCode %></td>
              <td><%= board.appointmentDecisionNumber %></td>
              <td>
                <%= board.startDateGregorian.toISOString().split('T')[0] %>
              </td>
              <td><%= board.boardStatus %></td>
              <td><%= board.members ? board.members.length : 0 %></td>
              <td><%= board.reason || '' %></td>
              <td>
                <a href="/api/boards/<%= board._id %>">تعديل</a>
              </td>
              <td>
                <% if (board.decisionImage) { %>
                <a href="<%= board.decisionImage %>" target="_blank"
                  >عرض الصورة</a
                >
                <% } else { %> لا توجد صورة <% } %>
              </td>
            </tr>
            <% }); %> <% } else { %>
            <tr>
              <td colspan="8">لا توجد بيانات لعرضها</td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </body>
</html>
